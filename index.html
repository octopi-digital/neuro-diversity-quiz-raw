<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neuro Divergent Quiz</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom styles for smooth transitions -->
    <style>
      .rotate-180 {
        transform: rotate(180deg);
      }
    </style>
  </head>

  <body class="bg-white">
    <!-- Navbar starts -->
    <div class="shadow-md mb-10">
      <div
        class="py-2 max-w-screen-lg mx-auto flex justify-between items-center px-5 lg:px-0"
      >
        <!-- Logo -->
        <div>
          <img
            src="https://storage.googleapis.com/msgsndr/X11laCn76m2ZqQWTRr3w/media/67148a0780829f10a38821ff.png"
            class="h-16"
            alt="Logo"
          />
        </div>

        <!-- Hamburger Menu for Mobile -->
        <div class="md:hidden">
          <button class="text-gray-900 focus:outline-none" id="hamburger-btn">
            <!-- Hamburger Icon -->
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-4">
          <div class="group relative">
            <p
              class="text-gray-900 group-hover:bg-[#FF5300] hover:text-white px-2 py-1 rounded-md transition-colors duration-200"
            >
              Traits
            </p>
          </div>
          <div class="group relative">
            <p
              class="text-gray-900 group-hover:bg-[#FF5300] hover:text-white px-2 py-1 rounded-md transition-colors duration-200"
            >
              Conditions
            </p>
          </div>
          <div class="group relative">
            <p
              class="text-gray-900 group-hover:bg-[#FF5300] hover:text-white px-2 py-1 rounded-md transition-colors duration-200"
            >
              Diagnosis
            </p>
            <ul
              class="absolute left-0 mt-2 hidden group-hover:block bg-white shadow-lg rounded-md p-2"
            >
              <li>
                <p class="block px-4 py-2 text-gray-700 hover:text-gray-900">
                  As a Child
                </p>
              </li>
              <li>
                <p class="block px-4 py-2 text-gray-700 hover:text-gray-900">
                  As an Adult
                </p>
              </li>
              <li>
                <p class="block px-4 py-2 text-gray-700 hover:text-gray-900">
                  Self Diagnosis
                </p>
              </li>
            </ul>
          </div>
          <button
            class="py-1 px-3 bg-blue-500 hover:bg-blue-600 transition-colors duration-200 active:scale-95 text-white rounded-full ml-6"
          >
            Donate
          </button>
          <img
            src="https://storage.googleapis.com/msgsndr/X11laCn76m2ZqQWTRr3w/media/67148a07033706c1eef0f1af.png"
            class="h-16 ml-2"
            alt="Transparency"
          />
        </div>

        <!-- Mobile Menu -->
        <div
          id="mobile-menu"
          class="md:hidden absolute top-16 right-4 w-3/5 sm:w-1/3 max-h-[90vh] overflow-y-auto bg-white border shadow-2xl rounded-md z-50 hidden"
        >
          <ul class="w-full flex flex-col items-start p-4 divide-y">
            <li class="w-full">
              <p
                class="text-gray-900 w-full p-4 hover:bg-[#746E5E] rounded-md flex justify-between items-center"
                data-target="traits"
              >
                Traits
              </p>
            </li>
            <li class="w-full">
              <p
                class="text-gray-900 w-full p-4 hover:bg-[#746E5E] rounded-md flex justify-between items-center"
                data-target="conditions"
              >
                Conditions
              </p>
            </li>
            <li class="w-full">
              <p
                class="text-gray-900 w-full p-4 hover:bg-[#746E5E] rounded-md flex justify-between items-center"
                onclick="toggleSubmenu('diagnosis')"
              >
                Diagnosis
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="transition duration-200"
                  id="arrow-diagnosis"
                >
                  <path d="m6 9 6 6 6-6" />
                </svg>
              </p>
              <ul
                id="submenu-diagnosis"
                class="pl-4 hidden transition-all duration-300 ease-in-out"
              >
                <li>
                  <a
                    href="#"
                    class="block px-4 py-2 text-gray-700 hover:bg-gray-100"
                    >As a Child</a
                  >
                </li>
                <li>
                  <a
                    href="#"
                    class="block px-4 py-2 text-gray-700 hover:bg-gray-100"
                    >As an Adult</a
                  >
                </li>
                <li>
                  <a
                    href="#"
                    class="block px-4 py-2 text-gray-700 hover:bg-gray-100"
                    >Self Diagnosis</a
                  >
                </li>
              </ul>
            </li>
            <button
              class="py-2 px-3 mt-6 w-full bg-blue-500 hover:bg-blue-600 transition-colors duration-200 active:scale-95 text-white rounded-full"
            >
              Donate
            </button>
          </ul>
        </div>
      </div>
    </div>
    <!-- Navbar Ends -->

    <!-- Patient Info Form Starts -->
    <div
      class="f shadow-md my-auto bg-gray-100 p-5 m-5 md:p-8 lg:p-10 max-w-lg mx-auto rounded-lg bg-white"
      id="patient-info"
    >
      <h1 class="text-2xl font-bold text-[#1D126C] mb-6 text-center">
        Neurodivergent Workplace Inclusion Test
      </h1>
      <form id="patient-form">
        <div class="mb-4">
          <label class="block mb-1 font-medium" for="name">Name</label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Enter your name"
            class="w-full p-2 focus:outline-blue-500 border-gray-300 rounded"
          />
          <p id="name-error" class="text-red-600 text-sm hidden"></p>
        </div>

        <div class="mb-4">
          <label class="block mb-1 font-medium" for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="Enter your email address"
            class="w-full p-2 focus:outline-blue-500 border-gray-300 rounded"
          />
          <p id="email-error" class="text-red-600 text-sm hidden"></p>
        </div>

        <button
          onclick="renderQuiz"
          class="w-full p-3 bg-blue-600 hover:bg-blue-700 transition-colors duration-200 rounded-md text-white"
        >
          Start
        </button>
      </form>
    </div>
    <!-- Patient Info Ends -->

    <div id="answer_button" class="flex justify-center hidden">
      <button
        onclick="answerAllQuestionsRandomly()"
        class="bg-blue-500 text-white px-4 py-2 rounded-md mx-auto"
      >
        Answer All Questions
      </button>
    </div>

    <!-- Button for answering all questions for testing -->

    <div class="pb-16" id="quiz-app">
      <!-- Placeholder for Quiz content -->
    </div>

    <div
      class="overflow-x-auto flex flex-col justify-center"
      id="result-container"
    >
      <!-- Results will be injected here -->
    </div>
    <!-- Graph Section -->

    <!-- Charts -->
    <div id="charts-container" class="rounded-lg space-y-6 hidden my-16">
      <div id="si-container" class="bg-white max-w-screen-lg mx-auto">
        <p class="text-center text-2xl text-[#1d126c] font-semibold">
          Social Inclusion
        </p>
        <div
          class="h-[180px] flex justify-center w-full bg-white gap-4 overflow-x-auto"
        >
          <canvas id="si-graph" height="100"></canvas>
        </div>
      </div>
      <div id="dm-container" class="bg-white max-w-screen-lg mx-auto">
        <p class="text-center text-2xl text-[#1d126c] font-medium">
          Decision Making
        </p>
        <div class="h-[180px] flex justify-center w-full">
          <canvas id="dm-graph" height="100"></canvas>
        </div>
      </div>
      <div id="simp-container" class="bg-white max-w-screen-lg mx-auto">
        <p class="text-center text-2xl text-[#1d126c] font-medium">
          Sensory Impact
        </p>
        <div class="h-[180px] flex justify-center w-full bg-white">
          <canvas id="simp-graph" height="100"></canvas>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Mobile menu toggle
      const hamburgerBtn = document.getElementById("hamburger-btn");
      const mobileMenu = document.getElementById("mobile-menu");

      hamburgerBtn.addEventListener("click", () => {
        mobileMenu.classList.toggle("hidden");
      });

      // Submenu toggle
      function toggleSubmenu(menuId) {
        const submenu = document.getElementById(`submenu-${menuId}`);
        const arrow = document.getElementById(`arrow-${menuId}`);

        submenu.classList.toggle("hidden");
        arrow.classList.toggle("rotate-180");
      }

      // Close mobile menu if clicked outside
      document.addEventListener("click", function (event) {
        if (
          !mobileMenu.contains(event.target) &&
          !hamburgerBtn.contains(event.target)
        ) {
          mobileMenu.classList.add("hidden");
        }
      });

      // Patient Info JS Starts
      document.addEventListener("DOMContentLoaded", function () {
        const patientForm = document.getElementById("patient-form");
        const nameInput = document.getElementById("name");
        const emailInput = document.getElementById("email");
        const nameError = document.getElementById("name-error");
        const emailError = document.getElementById("email-error");

        patientForm.addEventListener("submit", function (e) {
          e.preventDefault();
          patientData = {
            name: nameInput.value,
            email: emailInput.value,
          };

          // Clear previous errors
          nameError.classList.add("hidden");
          emailError.classList.add("hidden");

          // Validate the input
          let hasError = false;
          if (!patientData.name) {
            nameError.textContent = "Name is required.";
            nameError.classList.remove("hidden");
            hasError = true;
          }
          if (!patientData.email) {
            emailError.textContent = "Email is required.";
            emailError.classList.remove("hidden");
            hasError = true;
          } else if (!/\S+@\S+\.\S+/.test(patientData.email)) {
            emailError.textContent = "Email address is invalid.";
            emailError.classList.remove("hidden");
            hasError = true;
          }

          // If no validation errors, log the data
          if (!hasError) {
            console.log("Patient Data Submitted:", patientData);
            // Reset the form (optional)
            // patientForm.reset();
            renderQuiz();
          }
        });
      });
      // Patient Info JS Ends

      // Quiz JS Starts

      const questions = [
        {
          question_id: 1,
          question_title: "I make an effort not to be by myself.",
        },
        { question_id: 2, question_title: "I am easily guided by others." },
        {
          question_id: 3,
          question_title:
            "When I make plans, I make an effort to include others.",
        },
        {
          question_id: 4,
          question_title: "I seek to get close and personal with others.",
        },
        {
          question_id: 5,
          question_title: "I make an effort to be around others.",
        },
        {
          question_id: 6,
          question_title: "I allow others to impact what I do.",
        },
        {
          question_id: 7,
          question_title:
            "I make an effort to participate in clubs and social organizations.",
        },
        {
          question_id: 8,
          question_title: "I work to have close relationships with others.",
        },
        {
          question_id: 9,
          question_title: "I make an effort to have others around me.",
        },
        {
          question_id: 10,
          question_title: "I prefer it when others act close to me.",
        },
        {
          question_id: 11,
          question_title:
            "I make an effort to be a part of what others are doing.",
        },
        {
          question_id: 12,
          question_title: "I permit others to greatly impact what I do.",
        },
        {
          question_id: 13,
          question_title:
            "I make an effort to join in with others doing activities together.",
        },
        {
          question_id: 14,
          question_title:
            "I make an effort to have close, personal relationships with others.",
        },
        {
          question_id: 15,
          question_title:
            "When I can, I am inclined to associate in groups that gather together regularly.",
        },
        {
          question_id: 16,
          question_title: "When others socialize, I tend to participate.",
        },
        {
          question_id: 17,
          question_title:
            "I prefer others to include me in what they are doing.",
        },
        {
          question_id: 18,
          question_title:
            "When around others, I am the one in command of things.",
        },
        {
          question_id: 19,
          question_title:
            "I prefer when others are deep and meaningful toward me.",
        },
        {
          question_id: 20,
          question_title:
            "I attempt to have others do things how I would do them.",
        },
        {
          question_id: 21,
          question_title:
            "I enjoy when others invite me to be a part of what they are doing.",
        },
        {
          question_id: 22,
          question_title: "I greatly assert what I think others should do.",
        },
        {
          question_id: 23,
          question_title: "I prefer others to act distant toward me.",
        },
        {
          question_id: 24,
          question_title:
            "I make an effort to influence others to do what I want done.",
        },
        {
          question_id: 25,
          question_title:
            "I enjoy when others ask me to join in with what they are doing.",
        },
        {
          question_id: 26,
          question_title:
            "When I am around others, I make an effort to exert my leadership.",
        },
        {
          question_id: 27,
          question_title:
            "I enjoy when others ask me to be a part of what they are doing.",
        },
        {
          question_id: 28,
          question_title:
            "When around others, I make every effort to be the leader.",
        },
        {
          question_id: 29,
          question_title:
            "I prefer that others behave aloof and reserved in their interaction with me.",
        },
        {
          question_id: 30,
          question_title:
            "I allow others to determine for themselves what to do.",
        },
        {
          question_id: 31,
          question_title:
            "When tasks or other jobs need to be completed I try to have ____________ do them my way.",
        },
        {
          question_id: 32,
          question_title: "I allow ____________ to make their own decisions.",
        },
        {
          question_id: 33,
          question_title:
            "I attempt to be open and approachable to ____________.",
        },
        {
          question_id: 34,
          question_title:
            "I prefer when ____________ behave(s) in a deep and meaningful way toward me.",
        },
        {
          question_id: 35,
          question_title: "I seek to have deep connections with ____________.",
        },
        {
          question_id: 36,
          question_title: "I freely allow ____________ to guide me.",
        },
        {
          question_id: 37,
          question_title:
            "I seek to have deep and meaningful connections with ____________.",
        },
        {
          question_id: 38,
          question_title:
            "I enjoy being included in conversations with ____________.",
        },
        {
          question_id: 39,
          question_title: "I allow ____________ to greatly impact my conduct.",
        },
        {
          question_id: 40,
          question_title:
            "I enjoy when ____________ ask(s) me to join in things.",
        },
        {
          question_id: 41,
          question_title:
            "I greatly assert what I think ____________ should do.",
        },
        {
          question_id: 42,
          question_title:
            "I allow ____________ to exert their leadership and take care of things.",
        },
        {
          question_id: 43,
          question_title:
            "My close relationships with ____________ is/are cool and reserved.",
        },
        {
          question_id: 44,
          question_title:
            "I want ____________ interaction with me to be cool and distant.",
        },
        {
          question_id: 45,
          question_title:
            "I behave somewhat distant and reserved with ____________.",
        },
        {
          question_id: 46,
          question_title:
            "I enjoy being asked to participate when ____________ is/are doing things.",
        },
        {
          question_id: 47,
          question_title:
            "Around ____________ I try to exert my leadership to get things done.",
        },
        {
          question_id: 48,
          question_title: "I prefer ____________ to act distant toward me.",
        },
        {
          question_id: 49,
          question_title:
            "I make an effort to be deep and meaningful with ____________.",
        },
        {
          question_id: 50,
          question_title: "I allow ____________ to be in charge of what I do.",
        },
        {
          question_id: 51,
          question_title:
            "I enjoy when ____________ ask(s) me to be included in what they are doing.",
        },
        {
          question_id: 52,
          question_title: "I prefer when ____________ act(s) close toward me.",
        },
        {
          question_id: 53,
          question_title:
            "I enjoy when ____________ ask(s) me to join in with what they are doing.",
        },
        {
          question_id: 54,
          question_title:
            "I enjoy when ____________ behave(s) kindly toward me.",
        },
        {
          question_id: 55,
          question_title:
            "When with a group of friends, I tend to go with the flow with ____________.",
        },
        {
          question_id: 56,
          question_title:
            "When someone offers me good advice, I take it from ____________.",
        },
        {
          question_id: 57,
          question_title: "I greet ____________ with a smile and a handshake.",
        },
        {
          question_id: 58,
          question_title:
            "When I see ____________ having a good time I jump in with both feet.",
        },
        {
          question_id: 59,
          question_title:
            "When I believe someone needs my advice, I give it freely to ____________.",
        },
        {
          question_id: 60,
          question_title:
            "I prefer ____________ to greet me with a hug, rather than a handshake.",
        },
      ];

      const responses = {};
      let patientData = {
        name: "",
        email: "",
      };
      let showResults = false;
      let errors = {};
      let score = {
        ExpressedSocialInclusion: 0,
        WantedSocialInclusion: 0,
        ExpressedDecissionMaking: 0,
        WantedDecissionMaking: 0,
        ExpressedAcceptance: 0,
        WantedAcceptance: 0,
        SensoryImpact: 0,
      };

      // Function to handle response changes
      function handleResponseChange(questionId, value) {
        responses[questionId] = value;
        errors[questionId] = false; // Clear error for this question
        console.log(responses);
      }

      function restart() {
        location.reload();
      }

      function answerAllQuestionsRandomly() {
        // Assuming your question sections are inside a `questions` array
        questions.forEach((question) => {
          // Generate a random integer from 0 to 4
          const randomAnswer = Math.floor(Math.random() * 5);

          // Find the radio input for this question and answer it randomly
          const inputSelector = `input[name="q-neuro-${question.question_id}"][value="${randomAnswer}"]`;
          const inputElement = document.querySelector(inputSelector);

          if (inputElement) {
            inputElement.checked = true; // Check the radio button

            // Update the responses object with the selected answer
            responses[question.question_id] = randomAnswer;
          }
        });

        // Log the updated responses object
        console.log("Updated Responses: ", responses);
      }

      // Function to calculate and display the score
      const calculateScore = () => {
        // Validate responses before calculating the score
        if (!validateResponses()) {
          alert("Please answer all questions before submitting.");
          return;
        }

        // Define the questions for EI
        const eiQuestions = [1, 3, 5, 7, 9, 11, 13, 15, 16, 38];

        // Calculate the EI score
        const eiScore = eiQuestions.reduce(
          (total, questionId) => total + responses[questionId], // Accessing the responses directly
          0
        );

        console.log("EI Score", eiScore);

        // Assign the EI score to the newScore object
        score.ExpressedSocialInclusion = eiScore;

        console.log("New Score Object:", score);
      };

      // Function to validate response
      function validateResponses() {
        errors = {};
        let allValid = true;

        questions.forEach((question) => {
          if (responses[question.question_id] === undefined) {
            errors[question.question_id] = true;
            allValid = false;
          }
        });

        return allValid;
      }

      // Quiz Results JS starts
      function renderResult() {
        const totalExpressed =
          score.ExpressedSocialInclusion +
          score.ExpressedDecissionMaking +
          score.ExpressedAcceptance;
        const totalWanted =
          score.WantedSocialInclusion +
          score.WantedDecissionMaking +
          score.WantedAcceptance;
        const overall = totalExpressed + totalWanted;
        console.log("patient data: ", patientData);
        const resultHTML = `
                <div class="space-y-3 grid grid-cols-1 mx-auto overflow-x-auto px-5 pb-2 ">
                  <h2 class="text-2xl font-bold text-[#1d126c]">Dear ${
                    patientData.name
                  },</h2>
                  <h2 class="text-2xl" style="margin-bottom: 2rem !important;">
                    Neurodivergent Workplace Inclusion Score:
                  </h2>
                  <div class="flex relative w-[1024px] ml-3  ">
                    <p class="-rotate-90 absolute top-1/2 right-[97%] font-bold text-green-500">EXPRESSED</p>
                    <div class="grid grid-cols-4 gap-3 w-full">
                      <div>
                        <p class="uppercase text-center text-blue-500 font-bold">Social Inclusion</p>
                        <div class=" border-2 border-[#746E5E]  overflow-hidden">
                          <p class="bg-[#746E5E] p-3 text-center text-white">Expressed Social Inclusion</p>
                          <p class="p-6 text-center text-xl font-medium">${
                            score.ExpressedSocialInclusion
                          }</p>
                        </div>
                      </div>
                      <div>
                        <p class="uppercase text-center text-[#009EEC] font-bold">Decision Making</p>
                        <div class=" bg-white border-2 border-[#746E5E] overflow-hidden">
                          <p class="bg-[#746E5E] p-3 text-center text-white">Expressed Decision Making</p>
                          <p class="p-6 text-center text-xl font-medium">${
                            score.ExpressedDecissionMaking
                          }</p>
                        </div>
                      </div>
                      <div>
                        <p class="uppercase text-center text-[#1D126C] font-bold">Acceptance</p>
                        <div class=" bg-white border-2 border-[#746E5E] overflow-hidden">
                          <p class="bg-[#746E5E] p-3 text-center text-white ">Expressed Acceptance</p>
                          <p class="p-6 text-center text-xl font-medium">${
                            score.ExpressedAcceptance
                          }</p>
                        </div>
                      </div>
                      <div>
                        <br />
                        <div class=" bg-white border-2 border-[#746E5E] overflow-hidden">
                          <p class="bg-[#39A281] text-white p-3 text-center">Total Expressed Behavior</p>
                          <p class="p-6 text-center text-xl font-medium">${totalExpressed}</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Wanted Row -->
                  <div class="flex relative w-[1024px] ml-3">
                    <p class="-rotate-90 absolute top-1/2 right-[98.5%] text-[#9B1980] font-bold">WANTED</p>
                    <div class="grid grid-cols-4 gap-3 w-full">
                      <div class=" bg-white border-2 border-[#746E5E] overflow-hidden">
                        <p class="bg-[#746E5E] p-3 text-center text-white">Wanted Social Inclusion</p>
                        <p class="p-6 text-center text-xl font-medium">${
                          score.WantedSocialInclusion
                        }</p>
                      </div>
                      <div class=" bg-white border-2 border-[#746E5E] overflow-hidden">
                        <p class="bg-[#746E5E] p-3 text-center text-white">Wanted Decision Making</p>
                        <p class="p-6 text-center text-xl font-medium">${
                          score.WantedDecissionMaking
                        }</p>
                      </div>
                      <div class=" bg-white border-2 border-[#746E5E] overflow-hidden">
                        <p class="bg-[#746E5E] p-3 text-center text-white">Wanted Acceptance</p>
                        <p class="p-6 text-center text-xl font-medium">${
                          score.WantedAcceptance
                        }</p>
                      </div>
                      <div class=" bg-white border-2 border-[#746E5E] overflow-hidden">
                        <p class="bg-[#9B1980] text-white p-3 text-center">Total Wanted Behavior</p>
                        <p class="p-6 text-center text-xl font-medium">${totalWanted}</p>
                      </div>
                    </div>
                  </div>

                  <!-- Overall Result -->
                  <div class="flex relative w-[1024px] ml-3">
                    <div class="grid grid-cols-4 gap-3 w-full">
                      <div class="border-2 border-[#746E5E] bg-white overflow-hidden">
                        <p class="bg-blue-500 text-white p-3 text-center">Total For Social Inclusion</p>
                        <p class="p-6 text-center text-xl font-medium">${
                          score.WantedSocialInclusion +
                          score.ExpressedSocialInclusion
                        }</p>
                      </div>
                      <div class=" bg-white border-2 border-[#746E5E] overflow-hidden bg-white">
                        <p class="bg-[#009EEC] text-white p-3 text-center">Total For Decision Making</p>
                        <p class="p-6 text-center text-xl font-medium">${
                          score.WantedDecissionMaking +
                          score.ExpressedDecissionMaking
                        }</p>
                      </div>
                      <div class=" bg-white border-2 border-[#746E5E] overflow-hidden  bg-white">
                        <p class="bg-[#1D126C] p-3 text-center text-white">Total For Acceptance</p>
                        <p class="p-6 text-center text-xl font-medium">${
                          score.WantedAcceptance + score.ExpressedAcceptance
                        }</p>
                      </div>
                      <div class=" bg-white border-2 border-[#746E5E] overflow-hidden  bg-white">
                        <p class="bg-[#E2D000] text-white p-3 text-center">Overall</p>
                        <p class="p-6 text-center text-xl font-medium">${overall}</p>
                      </div>
                    </div>
                  </div>
                </div>
              `;

        document.getElementById("result-container").innerHTML = resultHTML;
      }

      // Render the result when the page loads
      renderResult();
      // Quiz Results JS ends

      document.getElementById("result-container").classList.add("hidden");
      // document.getElementById("statisctics").classList.add("hidden");

      function handleSubmit() {
        console.log("handle Submit triggered");
        if (!validateResponses()) {
          alert("Please answer all questions before submitting.");
          return;
        }

        document.getElementById("quiz-app").classList.add("hidden");
        document.getElementById("result-container").classList.remove("hidden");
        document.getElementById("charts-container").classList.remove("hidden");

        // document.getElementById("statisctics").classList.remove("hidden");

        calculateScore();
        renderResult();

        const nameInput = document.getElementById("name").value;
        const emailInput = document.getElementById("email").value;
        patientData.email = emailInput;
        patientData.name = nameInput;

        const dataForWebHook = {
          responses,
          patientData,
          score,
        };

        sendToWebhook(dataForWebHook);

        const ctx = document.getElementById("si-graph").getContext("2d");

        const data = {
          labels: ["Expressed", "Wanted"],
          datasets: [
            {
              label: "",
              data: [
                score.ExpressedSocialInclusion,
                score.WantedSocialInclusion,
              ],
              backgroundColor: "#FC963B",
              barThickness: 30,
            },
          ],
        };

        const options = {
          indexAxis: "y", // Make the bars horizontal
          scales: {
            x: {
              beginAtZero: true,
              max: 30, // Set the maximum value to 30
              ticks: {
                stepSize: 5, // Set the step size to 5
              },
              grid: {
                borderDash: [3, 3], // Dashed lines for the X-axis
                color: "rgba(0, 0, 0, 0.1)", // Light gray lines for grid
              },
            },
            y: {
              grid: {
                borderDash: [3, 3], // Dashed lines for the Y-axis as well
                color: "rgba(0, 0, 0, 0.1)", // Light gray lines for grid
                drawBorder: false, // Remove border around y-axis
              },
            },
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              enabled: true,
            },
          },
        };

        const siGraph = new Chart(ctx, {
          type: "bar",
          data: data,
          options: options,
        });

        const dmCtx = document.getElementById("dm-graph").getContext("2d");
        new Chart(dmCtx, {
          type: "bar",
          data: {
            labels: ["Expressed", "Wanted"],
            datasets: [
              {
                label: "",
                data: [
                  score.ExpressedDecissionMaking,
                  score.WantedDecissionMaking,
                ],
                backgroundColor: "#FC963B",
                barThickness: 30,
              },
            ],
          },
          options: {
            indexAxis: "y", // Horizontal bar chart
            scales: {
              x: {
                beginAtZero: true,
                max: 30, // Adjust based on your data
                ticks: {
                  stepSize: 5,
                },
                grid: {
                  borderDash: [3, 3],
                  color: "rgba(0, 0, 0, 0.1)",
                },
              },
              y: {
                grid: {
                  borderDash: [3, 3],
                  color: "rgba(0, 0, 0, 0.1)",
                  drawBorder: false,
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                enabled: true,
              },
            },
          },
        });

        // Chart for Sensory Impact
        const siCtx = document.getElementById("simp-graph").getContext("2d");
        new Chart(siCtx, {
          type: "bar",
          data: {
            labels: ["Expressed", "Wanted"],
            datasets: [
              {
                label: "",
                data: [score.ExpressedAcceptance, score.WantedAcceptance],
                backgroundColor: "#FC963B",
                barThickness: 30,
              },
            ],
          },
          options: {
            indexAxis: "y", // Horizontal bar chart
            scales: {
              x: {
                beginAtZero: true,
                max: 30, // Adjust based on your data
                ticks: {
                  stepSize: 5,
                },
                grid: {
                  borderDash: [3, 3],
                  color: "rgba(0, 0, 0, 0.1)",
                },
              },
              y: {
                grid: {
                  borderDash: [3, 3],
                  color: "rgba(0, 0, 0, 0.1)",
                  drawBorder: false,
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                enabled: true,
              },
            },
          },
        });
      }

      function findQuestion(questionId) {
        for (const section of questions) {
          for (const question of section.questions) {
            if (question.question_id === questionId) {
              return question;
            }
          }
        }
        return null;
      }

      function findSectionName(questionId) {
        for (const section of questions) {
          if (section.questions.some((q) => q.question_id === questionId)) {
            return section.name;
          }
        }
        return null;
      }

      function handleReset() {
        responses = {};
        errors = {};
        showResults = false;
        renderQuiz();
      }

      document.getElementById("quiz-app").classList.add("hidden");
      // document.getElementById("quiz-app").classList.add("hidden");

      function renderQuiz() {
        document.getElementById("patient-info").classList.add("hidden");
        document.getElementById("quiz-app").classList.remove("hidden");
        document.getElementById("answer_button").classList.remove("hidden");

        const sensoryImpactTestQuestions = [
          "I enjoy listening to soft music while working/studying.",
          "Bright colors in art and design don't distract me.",
          "The smell of freshly baked bread is pleasant to me.",
          "I find the feeling of soft fabrics on my skin comfortable.",
          "I'm able to focus in quiet environments without distractions.",
          "Loud noises like construction equipment make me anxious or uncomfortable.",
          "I feel overwhelmed by the bright lights and colors in a shopping mall.",
          "The smell of strong perfumes or chemicals makes me feel unwell.",
          "I'm easily distracted by sudden movements or vibrations.",
          "Changes in routine or unexpected events cause me significant stress.",
          "I feel anxious or uncomfortable in crowded public spaces.",
          "Certain sounds, like background chatter or beeping devices, are distracting to me.",
          "I'm sensitive to strong tastes or smells that others might find unpleasant.",
          "The feeling of certain textures, like sandpaper or velvet, is unpleasant to me.",
          "I have difficulty filtering out background noises and focusing on a specific sound.",
          "I prefer to sit in a quiet, dimly lit area when working/studying.",
          "I enjoy activities that involve repetitive movements, like typing or drawing.",
          "The feeling of certain temperatures, like being too hot or cold, is uncomfortable to me.",
          "I'm sensitive to strong electromagnetic fields, like those from electronic devices or power lines.",
          "The feeling of being in a crowded space with multiple stimuli is overwhelming to me.",
        ];

        document.getElementById("quiz-app").innerHTML = `
        <div class="max-w-screen-sm mx-auto p-5">
          <!-- Neurodivergent Workplace Inclusion Test Section -->
          <h1 class="text-2xl font-bold text-center mb-6">Neurodivergent Workplace Inclusion Test</h1>
          ${questions
            .map(
              (question, questionIndex) => `
                <div class="mb-4 bg-gray-100 rounded-lg p-3">
                  <h4 class="font-semibold mb-2">${questionIndex + 1}. ${
                question.question_title
              }</h4>
                  <div>
                    ${
                      questionIndex + 1 <= 30
                        ? `
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="0"> Not at all</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="1"> Sometimes</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="2"> On Occasion</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="3"> Most of the time</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="4"> All the time</label>
                        `
                        : `
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="0"> No one</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="1"> One or two individuals</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="2"> Some individuals</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="3"> A small group of individuals</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="4"> Many individuals</label><br>
                          <label><input type="radio" name="q-neuro-${
                            questionIndex + 1
                          }" value="5"> Almost everyone</label>
                        `
                    }
                  </div>
                </div>
              `
            )
            .join("")}

          <!-- Sensory Impact Assessment Section -->
          <h1 class="text-2xl font-bold text-center mb-6 mt-16">Sensory Impact Assessment</h1>
          ${sensoryImpactTestQuestions
            .map(
              (question, questionIndex) => `
                <div class="mb-4 bg-gray-100 rounded-lg p-3">
                  <h4 class="font-semibold mb-2">${
                    questionIndex + 1
                  }. ${question}</h4>
                  <div>
                    <label><input type="radio" name="q-sensory-${
                      questionIndex + 1
                    }" value="0"> Strongly disagree</label><br>
                    <label><input type="radio" name="q-sensory-${
                      questionIndex + 1
                    }" value="1"> Somewhat disagree</label><br>
                    <label><input type="radio" name="q-sensory-${
                      questionIndex + 1
                    }" value="2"> Neutral</label><br>
                    <label><input type="radio" name="q-sensory-${
                      questionIndex + 1
                    }" value="3"> Somewhat agree</label><br>
                    <label><input type="radio" name="q-sensory-${
                      questionIndex + 1
                    }" value="4"> Strongly agree</label>
                  </div>
                </div>
              `
            )
            .join("")}
             <button onclick="handleSubmit()" class="mt-4 p-3 bg-blue-600 text-white rounded">Submit</button>
        </div>
      `;

        // document.getElementById("quiz-app").innerHTML = `
        //   <div class="max-w-screen-sm mx-auto p-5">
        //     <h1 class="text-2xl font-bold text-center mb-6">Neurodivergent Workplace Inclusion Test</h1>
        //     ${questions[0].sections
        //       .map(
        //         (section) => `
        //       <div class="bg-white rounded-lg p-5 border">
        //         <h2 class="text-xl font-semibold mb-2 -mt-1">${
        //           section.name
        //         }</h2>
        //         ${section.questions
        //           .map(
        //             (question, questionIndex) => `
        //           <div class="mb-4  p-4 rounded-lg bg-gray-100">
        //             <p class="font-medium">${questionIndex + 1}. ${
        //               question.question
        //             }</p>
        //             <div class="grid grid-cols-1">
        //               ${[0, 1, 2, 3, 4]
        //                 .map(
        //                   (value) => `
        //                 <label class="inline-flex items-center mr-4">
        //                   <input type="radio" name="question_${
        //                     question.question_id
        //                   }" value="${value}" onchange="handleResponseChange(${
        //                     question.question_id
        //                   }, ${value})">
        //                   <span class="px-1 ml-1 rounded hover:text-blue-500 cursor-pointer transition-colors duration-200 hover:bg-gray-100 ">${
        //                     value === 0
        //                       ? "Not at all"
        //                       : value === 1
        //                       ? "Sometimes"
        //                       : value === 2
        //                       ? "On Occasion"
        //                       : value === 3
        //                       ? "Most of the time"
        //                       : "All the time"
        //                   }</span>
        //                 </label>
        //               `
        //                 )
        //                 .join("")}
        //             </div>
        //             ${
        //               errors[question.question_id]
        //                 ? '<p class="text-red-500 text-sm">Please select an answer.</p>'
        //                 : ""
        //             }
        //           </div>
        //         `
        //           )
        //           .join("")}
        //       </div>
        //     `
        //       )
        //       .join("")}
        //     <button onclick="handleSubmit()" class="mt-4 p-3 bg-blue-600 text-white rounded">Submit</button>
        //   </div>
        // `;
      }

      // Initial render of the quiz

      // renderQuiz();
      // Quiz JS Ends

      function sendToWebhook(data) {
        fetch(
          "https://services.leadconnectorhq.com/hooks/X11laCn76m2ZqQWTRr3w/webhook-trigger/cefc5cfe-9f15-46e2-9652-13c315a58c67",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          }
        )
          .then((response) => response.json())
          .then((data) => {
            console.log("Webhook Success:", data);
          })
          .catch((error) => {
            console.error("Webhook Error:", error);
          });
      }
    </script>
  </body>
</html>
